// Generated by CoffeeScript 1.6.3
(function() {
    var http = require("http"),
        WebSocketServer = require("ws").Server,
        url = require("url"),
        _ = require("underscore"),
        ip = process.env.OPENSHIFT_NODEJS_IP || "127.0.0.1",
        port = process.env.OPENSHIFT_NODEJS_PORT || 8080,
        server;

    http = require("http");

    server = http.createServer(function(request, response) {
        response.writeHead(200, {
            "Content-Type": "text/plain"
        });
        response.write("Hello World");
        return response.end();
    }).listen(port, ip);

    var wss = new WebSocketServer({server: server});
    console.log('websocket server created');
    wss.on('connection', function(ws) {
        var id = setInterval(function() {
            ws.send(JSON.stringify(new Date()), function() {  });
        }, 1000);

        console.log('websocket connection open');
        ws.on('close', function() {
            console.log('websocket connection close');
            clearInterval(id);
        });
    });

    console.log("Server is running at " + ip + ":" + port);

}).call(this);
